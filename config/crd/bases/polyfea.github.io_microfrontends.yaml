---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: microfrontends.polyfea.github.io
spec:
  group: polyfea.github.io
  names:
    kind: MicroFrontend
    listKind: MicroFrontendList
    plural: microfrontends
    singular: microfrontend
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: MicroFrontend is the Schema for the microfrontends API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: MicroFrontendSpec defines the desired state of MicroFrontend
            properties:
              cacheControl:
                description: CacheControl defines the cache control header for the
                  micro frontend. This is only used if the caching strategy is set
                  to 'cache'.
                type: string
              cacheOptions:
                description: CacheOptions specifies the cache settings for the PWA,
                  including pre-caching and runtime caching.
                properties:
                  cacheRoutes:
                    description: CacheRoutes specifies the caching strategies for
                      different URL patterns.
                    items:
                      description: |-
                        CacheRoute defines the caching strategy for a specific URL pattern within a Progressive Web Application (PWA).
                        This struct allows for fine-tuned control over how different network requests are handled, enhancing performance, reliability, and offline capabilities based on the application's requirements.
                      properties:
                        destination:
                          description: |-
                            Destination is the optional destination URL for this caching strategy.
                            You can find the list of possible values here: https://developer.mozilla.org/en-US/docs/Web/API/Request/destination
                          type: string
                        maxAgeSeconds:
                          description: MaxAgeSeconds specifies the maximum age (in
                            seconds) for cached content.
                          format: int32
                          type: integer
                        method:
                          default: GET
                          description: Method specifies the HTTP method to be used
                            with this caching strategy. It defaults to "GET".
                          enum:
                          - DELETE
                          - GET
                          - HEAD
                          - PATCH
                          - POST
                          - PUT
                          type: string
                        pattern:
                          description: Pattern is the URL pattern to which this caching
                            strategy applies.
                          type: string
                        statuses:
                          default:
                          - 0
                          - 200
                          - 201
                          - 202
                          - 204
                          description: Statuses lists the HTTP status codes to be
                            cached. It defaults to [0, 200, 201, 202, 204].
                          items:
                            format: int32
                            type: integer
                          type: array
                        strategy:
                          default: cache-first
                          description: Strategy defines the caching strategy to be
                            used for this URL pattern. It defaults to "cache-first".
                          enum:
                          - cache-first
                          - network-first
                          - cache-only
                          - network-only
                          - stale-while-revalidate
                          type: string
                        syncRetentionMinutes:
                          description: SyncRetentionMinutes specifies the duration
                            (in minutes) to retain synced content in the cache.
                          format: int32
                          type: integer
                      required:
                      - pattern
                      type: object
                    type: array
                  preCache:
                    description: PreCache lists the URLs or resources to be pre-cached
                      when the PWA is installed.
                    items:
                      description: |-
                        PreCacheEntry represents an individual entry in the pre-cache list for a Progressive Web Application (PWA).
                        Each entry specifies a URL to be cached and an optional revision identifier to manage cache updates and invalidation.
                      properties:
                        revision:
                          description: |-
                            Revision is an optional field that specifies a revision identifier for the resource.
                            The revision helps in cache management by allowing the service worker to recognize and update cached assets when their content changes. This ensures users always have access to the most up-to-date resources.
                          type: string
                        url:
                          description: |-
                            URL specifies the resource URL that should be pre-cached. This URL points to the asset that needs to be available offline, ensuring it is cached during the installation of the PWA.
                            URL needs to be relative to the base URL of the frontend class.
                          type: string
                      required:
                      - url
                      type: object
                    type: array
                type: object
              cacheStrategy:
                default: none
                description: CachingStrategy defines the caching strategy for the
                  micro frontend.
                enum:
                - none
                - cache
                type: string
              dependsOn:
                description: List of dependencies that should be loaded before this
                  micro frontend.
                items:
                  type: string
                type: array
              frontendClass:
                default: polyfea-controller-default
                description: FrontendClass is the name of the frontend class that
                  should be used for this micro frontend.
                type: string
              importMap:
                description: |-
                  ImportMap defines module specifier mappings for this microfrontend.
                  These entries are merged at the MicroFrontendClass level. In case of conflicts between
                  microfrontends, first-registered wins (based on creation timestamp).
                properties:
                  imports:
                    additionalProperties:
                      type: string
                    description: |-
                      Imports maps bare module specifiers to paths (relative to this microfrontend's service)
                      or absolute URLs.
                      Example: {"angular": "./bundle/angular.mjs", "react": "https://cdn.example.com/react.js"}
                    type: object
                  scopes:
                    additionalProperties:
                      additionalProperties:
                        type: string
                      type: object
                    description: |-
                      Scopes allows different module resolutions based on the referrer URL path.
                      Keys are URL path prefixes, values are import maps that apply within that scope.
                      Example: {"/legacy/": {"angular": "./old-angular.mjs"}}
                    type: object
                type: object
              modulePath:
                description: Relative path to the module file within the service.
                type: string
              proxy:
                default: true
                description: This specifies whether the loading of web components
                  should be proxied by the controller.
                type: boolean
              service:
                description: Reference to a service from which the modules or css
                  would be served.
                properties:
                  domain:
                    default: svc.cluster.local
                    description: |-
                      Domain is the cluster domain suffix. Defaults to svc.cluster.local if not specified.
                      Only used when Name is set. Allows customization for different cluster implementations.
                    type: string
                  name:
                    description: Name of the Kubernetes service (mutually exclusive
                      with URI)
                    type: string
                  namespace:
                    description: |-
                      Namespace of the service. Defaults to the MicroFrontend's namespace if not specified.
                      Only used when Name is set.
                    type: string
                  port:
                    default: 80
                    description: |-
                      Port of the service. Defaults to 80 if not specified.
                      Only used when Name is set.
                    format: int32
                    type: integer
                  scheme:
                    default: http
                    description: |-
                      Scheme to use for connection (http or https). Defaults to http.
                      Only used when Name is set.
                    enum:
                    - http
                    - https
                    type: string
                  uri:
                    description: |-
                      URI for external services (mutually exclusive with Name)
                      Should include schema (http:// or https://)
                    type: string
                type: object
                x-kubernetes-validations:
                - message: Either 'name' or 'uri' must be specified, but not both
                  rule: (has(self.name) && size(self.name) > 0) != (has(self.uri)
                    && size(self.uri) > 0)
              staticPaths:
                description: Relative path to the static files within the service.
                items:
                  description: StaticResources defines the static resources that should
                    be loaded before this micro frontend.
                  properties:
                    attributes:
                      items:
                        description: Attribute defines a key-value pair that allows
                          you to assign specific attributes to the element. The name
                          field is used as the attribute name, while the value field
                          can be any valid JSON type.
                        properties:
                          name:
                            description: The name of the attribute.
                            type: string
                          value:
                            description: The value of the attribute.
                            x-kubernetes-preserve-unknown-fields: true
                        required:
                        - name
                        - value
                        type: object
                      type: array
                    kind:
                      description: Kind defines the kind of the static resource can
                        be script, stylesheet, or any other `link` element.
                      type: string
                    path:
                      type: string
                    proxy:
                      default: true
                      description: This specifies whether the loading of static resource
                        components should be proxied by the controller.
                      type: boolean
                    waitOnLoad:
                      description: WaitOnLoad defines whether the micro frontend should
                        wait for the static resource to load before loading itself.
                      type: boolean
                  required:
                  - kind
                  - path
                  type: object
                type: array
            required:
            - frontendClass
            - modulePath
            - service
            type: object
          status:
            description: MicroFrontendStatus defines the observed state of MicroFrontend
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the MicroFrontend's state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              frontendClassRef:
                description: FrontendClassRef indicates which MicroFrontendClass this
                  microfrontend is bound to
                properties:
                  accepted:
                    description: Accepted indicates if this MicroFrontend is accepted
                      by the class's namespace policy
                    type: boolean
                  name:
                    description: Name of the MicroFrontendClass
                    type: string
                  namespace:
                    description: Namespace of the MicroFrontendClass
                    type: string
                required:
                - accepted
                - name
                type: object
              importMapConflicts:
                description: |-
                  ImportMapConflicts lists module specifiers that couldn't be registered
                  due to conflicts with other microfrontends (first-registered wins)
                items:
                  description: ImportMapConflict describes a module specifier conflict
                    in the import map
                  properties:
                    registeredBy:
                      description: RegisteredBy indicates which microfrontend registered
                        it first (namespace/name)
                      type: string
                    registeredPath:
                      description: RegisteredPath is what's actually registered (from
                        another microfrontend)
                      type: string
                    requestedPath:
                      description: RequestedPath is what this microfrontend requested
                      type: string
                    scope:
                      description: Scope is the scope path where the conflict occurred
                        (empty string for top-level imports)
                      type: string
                    specifier:
                      description: Specifier is the module name that has a conflict
                      type: string
                  required:
                  - registeredBy
                  - registeredPath
                  - requestedPath
                  - specifier
                  type: object
                type: array
              observedGeneration:
                description: ObservedGeneration reflects the generation of the most
                  recently observed MicroFrontend
                format: int64
                type: integer
              phase:
                description: |-
                  Phase represents the current lifecycle phase of the MicroFrontend
                  Possible values: Pending, Ready, Failed, Rejected
                enum:
                - Pending
                - Ready
                - Failed
                - Rejected
                type: string
              rejectionReason:
                description: RejectionReason explains why the microfrontend was rejected
                  (namespace policy violation, etc.)
                type: string
              resolvedServiceURL:
                description: ResolvedServiceURL is the computed URL where the microfrontend
                  is served from
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
